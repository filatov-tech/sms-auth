# Тестовый проект реализации мультишагового сервиса аутентификации
## Задание
1. Кейс
   - Человек вводит номер телефона
   - Если пользователь есть, просим пароль, если нет - то к паролю еще требуем Имя Фамилию для создания пользователя
   - Запрашиваем смс код (СМС сервис можно замокать и сделать 111111 как верный код)
2. Подключить миграции через Liquibase и отключить ddl
3. Сделать базовое API для получения инфы о юзере используя GraphQL.

Язык: Kotlin
Spring Boot 3+ + Spring GraphQL

## Используемый подход
Основная задача проекта - продемонстрировать вариант реализации мультишаговой аутентификации с помощью смс. Реализации вспомогательных технологий в проекте значительно упрощены. Например, реализация JWT аутентификации, использование и обработка токенов, упрощены до необходимого минимума.
Проект использует только GraphQL, без REST-эндпойнтов.

## Реализация
Мультишаговость, обозначенная в задании, реализована следующим образом. 
Для проверки номера есть специальный публичный (не требующий аутентификации) запрос, который вернет true, если пользователь зарегистрирован в системе.
Далее, для обоих случаев: когда пользователь регистрируется и когда он просто логинится, предусмотрены два соответствующих публичных запроса. Заполнив требуемые данные, эти запросы, в случае успеха, отправят пользователю сообщение с одноразовым паролем и вернут клиентскому приложению временный токен, который нужно добавить в запроса для  верификации одноразового пароля. Для этого есть еще один метод, доступ к которому открывается только при наличии временного токена.
После верификации одноразового пароля, пользователь считается аутентифицирован, а клиентское приложение получает уже обычный токен, который необходимо добавлять ко всем последующим запросам.

Таким образом, пошагово процесс аутентификации выглядит так:
1. Проверка номера
2. Ввод пользователем требуемых данных
3. Получение пользователем одноразового пароля и временного токена для его верификации
4. Верификация одноразового пароля
5. Получение пользователем токена аутентификации

## Основной use case

### UC-1 “Аутентификация пользователя в системе с помощью телефонного номера и СМС”
#### Цель
Получить доступ в систему
#### Акторы
Пользователь
#### Начальное состояние
Пользователь не аутентифицирован в системе
#### Основной сценарий
1. Пользователь вводит свой номер телефона
2. Система проверяет зарегистрирован ли пользователь в системе
   - если да, то система требует ввести пароль
   - если нет, то система требует ввести пароль, имя и фамилию
3. Пользователь вводит требуемую информацию.
4. Система проверяет введенный пароль
   - если зарегистрированный пользователь ввел неверный пароль, система сообщает ему об этом и предлагает повторить попытку ввода
5. Система отправляет код подтверждения на указанный пользователем номер телефона
6. Пользователь вводит полученный код в систему
   - если код введен корректно, система аутентифицирует его и предоставляет доступ к себе
   - если введен неверный код, то система предлагает повторить попытку ввода 
#### Постусловия
- Успешная аутентификация: Пользователь получает доступ к функционалу системы.
- Неудачная аутентификация: Пользователь остается без доступа к системе.
#### Альтернативный сценарий №1
##### Предусловие: пользователю не приходит сообщение с кодом. 
1. Если пользователь не получает код подтверждения, он запрашивает повторную отправку кода.
2. Если с момента последнего запроса прошло достаточно времени, то система дает возможность запросить код повторно. Если времени прошло недостаточно, то система предлагает пользователю подождать оставшееся время и снова запросить сообщение с кодом (не реализовано)
##### Предусловие: зарегистрированный пользователь не помнит свой пароль. 
Пользователь инициирует процедуру восстановления пароля (не реализовано)

## Стек
- JDK 17
- Spring Boot
- Spring Security
- Spring Data JPA
- H2 (in memory)
- GraphQL
- JWT
